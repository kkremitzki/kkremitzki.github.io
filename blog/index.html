<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns#
article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Notes on my journey in biosystems engineering.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Biosystems Engineering Blog</title>
<link href="../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.xml">
<link rel="canonical" href=".">
<link rel="icon" href="../favicon.ico" sizes="16x16">
<link rel="next" href="index-1.html" type="text/html">
<!--[if lt IE 9]><script src="../assets/js/html5.js"></script><![endif]--><script src="../assets/js/jquery.min.js"></script><link rel="stylesheet" href="../assets/css/custom.css">
<link rel="stylesheet" href="../assets/css/code.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../">

                <span id="blog-title">Biosystems Engineering Blog</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../">About</a>
                </li>
<li class="active">
<a href=".">Blog <span class="sr-only">(active)</span></a>
                </li>
<li>
<a href="tags">Tags</a>
                </li>
<li>
<a href="https://github.com/kkremitzki">GitHub</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
    
    
<div class="postindex">
    <article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="gsoc-week-8-recap/" class="u-url">GSoC Week 8 Recap</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Kurt Kremitzki
            </span></p>
            <p class="dateline"><a href="gsoc-week-8-recap/" rel="bookmark"><time class="published dt-published" datetime="2017-08-04T03:19:02-05:00" title="2017-08-04 03:19">2017-08-04 03:19</time></a></p>
                <p class="commentline">            <a href="gsoc-week-8-recap/#disqus_thread" data-disqus-identifier="cache/posts/gsoc-week-8-recap.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Total tool coverage lasted less than a week! It's a good thing though, because that means a new tool <a class="reference external" href="https://github.com/FreeCAD/FreeCAD/pull/898">landed in master</a>: PartDesign Hole.</p>
<object class="align-center" data="../images/PartDesign_Hole.svg" type="image/svg+xml">
Part Design Hole tool</object>
<p>This is a really great tool for the Part Design WB not only because holes (and their corresponding fasteners) are ubiquitous in part design generally,
but also because the tool does a good job of capturing that information into a FreeCAD object that can be later be hooked into for both the
Assembly and TechDraw workbenches. For example, the options I've selected in the following screenshot could be used to complete a technical drawing
for this part in FreeCAD, and that information exchange could be done in an automated and customizable way.</p>
<img alt="Part Design Hole tool" class="align-center" src="../images/gsoc-8-1.png"><p>This information could also be used by the Path WB to generate control code for open-source, automated manufacturing processes and machines, so it's really
great to have such a full-featured tool added.</p>
<p>I spent some time trying to find bugs in the tool, but didn't really find any. The only gotcha I noticed is related to the orientation of sketches which serve as the
basis for holes. There is no Reverse option for the Hole feature itself, so for example, if you have a sketch on the "bottom" of an object but not attached to it,
you may need to set the Map Reversed option for the sketch itself to true.</p>
<p>Some tests will be forthcoming for Hole, but besides that, I also spent some time looking at few outstanding bugs in C++-land.</p>
<p>Particularly,</p>
<ul class="simple">
<li>(mentioned in week 5) ShapeBinder crash when base object not initially selected due to null pointer dereference</li>
<li>(mentioned in week 3) Revolution has unhandled error for some bad revolution axis choices, does bad revolution without error for others</li>
<li>(new) Pipe fails when its path is a loop. For example, a Pipe with a circle as a base and a larger, orthogonal circle passing through the base should become a torus.
Currently, it fails with the wonderfully verbose error message 'TopoDS::Shell'.</li>
</ul>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="gsoc-week-7-recap/" class="u-url">GSoC Week 7 Recap</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Kurt Kremitzki
            </span></p>
            <p class="dateline"><a href="gsoc-week-7-recap/" rel="bookmark"><time class="published dt-published" datetime="2017-07-28T15:30:58-05:00" title="2017-07-28 15:30">2017-07-28 15:30</time></a></p>
                <p class="commentline">            <a href="gsoc-week-7-recap/#disqus_thread" data-disqus-identifier="cache/posts/gsoc-week-7-recap.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>I hit a nice milestone this week! With <a class="reference external" href="https://github.com/FreeCAD/FreeCAD/pull/899">PR 899</a> I hit total tool <em>test</em> coverage for the Part Design workbench.
Now, what exactly does that mean? Well, if you look at my screenshot of the workbench tools from Week 2, every one of those is now covered by tests with most
key functionality hit. Some of them, like the dressup features Fillet and Chamfer, only have one test, either because the tool is simple or because further tests
lie outside the scope of the Part Design workbench (e.g. testing the topological naming robustness of Fillet to recalculation.)</p>
<p>The PartDesign Primitive (Box, Cylinder, Sphere, Cone, Ellipsoid, Torus, Prism, and Wedge) tests were interesting to write.
I was able to cover basic construction of both Additive and Subtractive primitives of each type by simply making a large Additive Primitive
and smaller Subtractive Primitive inside the first, and then ensuring that the ensuing Shape's Volume property was about equal to
the difference in volumes according to the formula for that shape, e.g.</p>
<p>\[
\mathrm{Shape.Volume}\ \approx V = \frac{4}{3}\pi (R^3 - r^3)
\]</p>
<p>for Additive-<span class="math">\(R\)</span> and Subtractive-<span class="math">\(r\)</span> Primitive Spheres.
I had to look up a few volume formulas but otherwise the tests for the lengthly list in the parentheses above went quickly.</p>
<p>I also fixed a bug with Loft sections not being hidden, so e.g. the Sketches being lofted to or through were still visible.</p>
<p>Additionally, there was an issue with both Loft and Pipe not claiming children correctly in the tree which I fixed.</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="gsoc-week-6-recap/" class="u-url">GSoC Week 6 Recap</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Kurt Kremitzki
            </span></p>
            <p class="dateline"><a href="gsoc-week-6-recap/" rel="bookmark"><time class="published dt-published" datetime="2017-07-21T00:26:28-05:00" title="2017-07-21 00:26">2017-07-21 00:26</time></a></p>
                <p class="commentline">            <a href="gsoc-week-6-recap/#disqus_thread" data-disqus-identifier="cache/posts/gsoc-week-6-recap.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Short post this week! I was in Spokane, Washington, from July 15-19th for a robotics competition being held at the Annual International Meeting of my professional society,
the American Society of Agricultural &amp; Biological Engineers, or ASABE. I only had a smattering of time to work on the various FreeCAD bugs I have mentioned in previous posts
so there isn't much to report on that front. Instead, I'll leave a picture from the beautiful Spokane downtown area.</p>
<img alt="/images/gsoc-6-1.jpg" class="align-center" src="../images/gsoc-6-1.jpg">
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="gsoc-week-5-recap/" class="u-url">GSoC Week 5 recap</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Kurt Kremitzki
            </span></p>
            <p class="dateline"><a href="gsoc-week-5-recap/" rel="bookmark"><time class="published dt-published" datetime="2017-07-11T14:45:35-05:00" title="2017-07-11 14:45">2017-07-11 14:45</time></a></p>
                <p class="commentline">            <a href="gsoc-week-5-recap/#disqus_thread" data-disqus-identifier="cache/posts/gsoc-week-5-recap.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>This week started out with some interesting discussions on the future Python structure of FreeCAD, over
<a class="reference external" href="https://forum.freecadweb.org/viewtopic.php?f=10&amp;t=23197">on the forums</a>. This was especially salient
as I have a bit of pain interacting with parts of the FreeCAD Python API and improvements to it would
be a good long-term goal after finishing GSoC.</p>
<p>I decided that the <tt class="docutils literal">TestPartDesignApp.py</tt> file I had been working in thus far needed splitting up,
as I was cramming almost every new test into it.
The <a class="reference external" href="https://github.com/FreeCAD/FreeCAD/blob/master/src/Mod/PartDesign/TestPartDesignApp.py">new version of this file</a>
is a pretty nice indicator of the overall status of PartDesign test coverage.</p>
<p>I also added some basic tests for datum tools, covering simple creation scenarios. While exploring the 4th datum
tool, <tt class="docutils literal">ShapeBinder</tt>, I found a bug that causes a crash, so I will need to look into that shortly to see if it's an
easy fix.</p>
<p><tt class="docutils literal">LinearPattern</tt> and <tt class="docutils literal">PolarPattern</tt> got 6 new tests each, covering all the major variations of sketch-
or primitive-based features.</p>
<p>Finally, I added one new test for each of the dressup features, <tt class="docutils literal">Fillet</tt>, <tt class="docutils literal">Chamfer</tt>, <tt class="docutils literal">Draft</tt>, and <tt class="docutils literal">Thickness</tt>.</p>
<p>Here's the pull request summarizing my work: <a class="reference external" href="https://github.com/FreeCAD/FreeCAD/pull/869">https://github.com/FreeCAD/FreeCAD/pull/869</a></p>
<table border="1" class="docutils">
<colgroup>
<col width="33%">
<col width="28%">
<col width="11%">
<col width="28%">
</colgroup>
<thead valign="bottom"><tr>
<th class="head">tool category</th>
<th class="head">initial, current test count</th>
<th class="head">status</th>
<th class="head">notes</th>
</tr></thead>
<tbody valign="top">
<tr>
<td>datum tools</td>
<td>0, 3</td>
<td>ready</td>
<td>found shapebinder crash bug</td>
</tr>
<tr>
<td>add. &amp; sub. features/primitives</td>
<td>15, 15</td>
<td>ready</td>
<td> </td>
</tr>
<tr>
<td>transformations</td>
<td>3, 15</td>
<td>ready</td>
<td>all done but MultiTransform</td>
</tr>
<tr>
<td>dressup features</td>
<td>0, 4</td>
<td>ready</td>
<td> </td>
</tr>
<tr>
<td>boolean operation</td>
<td>0, 0</td>
<td>ready</td>
<td> </td>
</tr>
</tbody>
</table>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="gsoc-week-4-recap/" class="u-url">GSoC Week 4 recap</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Kurt Kremitzki
            </span></p>
            <p class="dateline"><a href="gsoc-week-4-recap/" rel="bookmark"><time class="published dt-published" datetime="2017-06-30T05:48:06-05:00" title="2017-06-30 05:48">2017-06-30 05:48</time></a></p>
                <p class="commentline">            <a href="gsoc-week-4-recap/#disqus_thread" data-disqus-identifier="cache/posts/gsoc-week-4-recap.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>I started this week out with the goal of troubleshooting the bugs I found with PartDesign Pipe and Revolve.
However, I ended up running into several annoying issues. The LLDB debugging integration I previously wrote about
began showing some inexplicable errors:</p>
<pre class="literal-block">
error caught in async handler 'exec ('continue',)'
Traceback (most recent call last):
  File "/home/kurt/.config/nvim/bundles/repos/github.com/dbgx/lldb.nvim/rplugin/python/lldb_nvim/__init_
_.py", line 49, in _exec
    self.ctrl.safe_execute(args)
  File "/home/kurt/.config/nvim/bundles/repos/github.com/dbgx/lldb.nvim/rplugin/python/lldb_nvim/control
ler.py", line 101, in safe_execute
    self.safe_call(self.exec_command, [cmd])
  File "/home/kurt/.config/nvim/bundles/repos/github.com/dbgx/lldb.nvim/rplugin/python/lldb_nvim/control
ler.py", line 94, in safe_call
    raise EventLoopError("Dead event loop!")
EventLoopError: Dead event loop!
</pre>
<p>Eventually I found <a class="reference external" href="https://github.com/dbgx/lldb.nvim/issues/52">an issue on Github</a> which refers to
a now-deleted comment in the author's original repository, stating the project was no longer being developed.
The question remains as to how it was working just fine when I began and only just now stopped working, but
the end result was that my debugger-editor integration was broken, which makes it quite a bit tougher to debug
the C++ side of the codebase.</p>
<p>One option I had was to just use GDB as a standalone command line application, but it's really convenient, e.g.
to not have to manually type out file names and line numbers for breakpoints, and otherwise have your debugger
wired up to your editor.</p>
<p>However, this was inexplicably not working either! Basic features of GDB worked, but trying to specify breakpoints
to step through the code was not. I banged my head on this issue for a while until I figured up <tt class="docutils literal">ccmake</tt> to
take a look at my build options. The issue? Somehow, the <tt class="docutils literal">CMAKE_BUILD_TYPE</tt>, which had been set to <tt class="docutils literal">Debug</tt>,
was unset. So, I set it again and started the debug build, which takes quite a long time.
(Around 2 hours with <tt class="docutils literal">make <span class="pre">-j4</span></tt>.)</p>
<p>I also did more research on options for debugger integration. I found an interesting option called Pyclewn
which is a debugger front-end for (neo)vim. This option was attractive since I could have a unified front-end
to both my C++ debugger as well as a Python one. However, setup wasn't straightforward, so I continued searching
for a simpler option.</p>
<p>Luckily, I stumbled upon <a class="reference external" href="https://github.com/neovim/neovim/blob/master/contrib/gdb/neovim_gdb.vim">neovim_gdb.vim</a>,
a simple combination of vim settings, available in the <tt class="docutils literal">contrib</tt> folder of the neovim repository.</p>
<p>Once that was taken care of, I started working on my original objective for the week. I found that the
PartDesign Pipe issue was being caused by the code checking for whether or not the Pipe's AuxillerySpine (sic)
was a part of the active body, but didn't check if the thing existed first. This resulted in a check to
see if a null pointer was part of the active body, which is never the case. Checking for existence first
<a class="reference external" href="https://github.com/FreeCAD/FreeCAD/pull/848">resolved the issue</a>. With that bug fixed, I also added
two tests each for PartDesign Pipe and Loft.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%">
<col width="28%">
<col width="11%">
<col width="28%">
</colgroup>
<thead valign="bottom"><tr>
<th class="head">tool category</th>
<th class="head">initial, current test count</th>
<th class="head">status</th>
<th class="head">notes</th>
</tr></thead>
<tbody valign="top">
<tr>
<td>datum tools</td>
<td>0, 0</td>
<td>ready</td>
<td> </td>
</tr>
<tr>
<td>add. &amp; sub. features/primitives</td>
<td>11, 15</td>
<td>ready</td>
<td>all additive &amp; subtractive
features now have at least
one test</td>
</tr>
<tr>
<td>transformations</td>
<td>3, 3</td>
<td>ready</td>
<td> </td>
</tr>
<tr>
<td>dressup features</td>
<td>0, 0</td>
<td>ready</td>
<td> </td>
</tr>
<tr>
<td>boolean operation</td>
<td>0, 0</td>
<td>ready</td>
<td> </td>
</tr>
</tbody>
</table>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="gsoc-week-3-recap/" class="u-url">GSoC Week 3 recap</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Kurt Kremitzki
            </span></p>
            <p class="dateline"><a href="gsoc-week-3-recap/" rel="bookmark"><time class="published dt-published" datetime="2017-06-22T11:15:49-05:00" title="2017-06-22 11:15">2017-06-22 11:15</time></a></p>
                <p class="commentline">            <a href="gsoc-week-3-recap/#disqus_thread" data-disqus-identifier="cache/posts/gsoc-week-3-recap.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Howdy! I wasn't sure of the best way to represent my progress thus far, but I figure a table is an alright way to summarize.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%">
<col width="28%">
<col width="11%">
<col width="28%">
</colgroup>
<thead valign="bottom"><tr>
<th class="head">tool category</th>
<th class="head">initial, current test count</th>
<th class="head">status</th>
<th class="head">notes</th>
</tr></thead>
<tbody valign="top">
<tr>
<td>datum tools</td>
<td>0, 0</td>
<td>hold</td>
<td>waiting on attachment
editor work in phase 2</td>
</tr>
<tr>
<td>add. &amp; sub. features/primitives</td>
<td>3, 11</td>
<td>blocked</td>
<td>basic Pipe not working; when
fixed, all tools in this
category (but not all their
options) will have test
coverage</td>
</tr>
<tr>
<td>transformations</td>
<td>0, 3</td>
<td>ready</td>
<td>Mirrored added, still need
Linear and PolarPattern</td>
</tr>
<tr>
<td>dressup features</td>
<td>0, 0</td>
<td>ready</td>
<td> </td>
</tr>
<tr>
<td>boolean operation</td>
<td>0, 0</td>
<td>ready</td>
<td>Previously seemed to
misbehave but recent changes
to containers may have fixed
this</td>
</tr>
</tbody>
</table>
<p>I got my Pad &amp; Pocket tests added, so right now the total Δtests is 11. Next up is Loft and Pipe. However,
Pipe has a bit of a blocking bug right now. My test scenario involves a simple circle centered at the origin
in an XY-attached sketch, serving as the base Profile, and a simple line on the Z axis in an XZ-attached sketch.
The test construction is illustrated in figure 1.</p>
<p>This should result in a cylinder, as the preview indicates in figure 2. For some reason, when clicking OK,
an external reference warning is being generated, and this is blocking any test constructions for PartDesign Pipe.</p>
<div class="figure align-center">
<img alt="test pipe construction" src="../images/gsoc-3-3.png" style="width: 300px;"><p class="caption">Figure 1. PartDesign Pipe Profile and Spine sketches which should form a simple cylinder.</p>
</div>
<div class="figure align-center">
<img alt="external reference warning" src="../images/gsoc-3-4.png" style="width: 600px;"><p class="caption">Figure 2. PartDesign Pipe erroneously warning about external references.</p>
</div>
<p>I also ran into a bug in PartDesign Revolve, which, as bugs are wont to do, ended up being two bugs.
The construction case to see them is depicted in figure 3.</p>
<div class="figure align-center">
<img alt="revolution sketches" src="../images/gsoc-3-1.png" style="width: 300px;"><p class="caption">Figure 3. Simple sketches attached to the three base planes.</p>
</div>
<p>I attached a simple circle sketch to each of the three base planes, and offset them so they wouldn't be symmetric
with respect to the origin or any base axes. When attempting to add a Revolution with these sketches, they behave
as expected, until one attempts to revolve them about the axis which is normal to the sketch's plane. For the
XY- and YZ-attached sketches, the following error appears:</p>
<blockquote>
Unhandled Base::Exception caught in GUIApplication::notify.
The error message is: Rotation axis must not be perpendicular with the sketch plane</blockquote>
<p>However, if one tries to revolve the XZ-attached circle, FreeCAD gives it the ol' college try, but
ends up with an awfully thin "solid":</p>
<div class="figure align-center">
<img alt="faulty revolution" src="../images/gsoc-3-2.png" style="width: 300px;"><p class="caption">Figure 4. An "error-free" PartDesign Revolution.</p>
</div>
<p>I'll also be looking into these bugs this week.</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="gsoc-week-2-recap/" class="u-url">GSoC Week 2 recap</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Kurt Kremitzki
            </span></p>
            <p class="dateline"><a href="gsoc-week-2-recap/" rel="bookmark"><time class="published dt-published" datetime="2017-06-18T18:40:33-05:00" title="2017-06-18 18:40">2017-06-18 18:40</time></a></p>
                <p class="commentline">            <a href="gsoc-week-2-recap/#disqus_thread" data-disqus-identifier="cache/posts/gsoc-week-2-recap.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>With the four major bugs blocking the usage of <tt class="docutils literal">PartDesign Mirrored</tt> fixed,
I started out the week exploring the now-functioning tool with the goal of getting what I call "command test coverage".
In short, this means testing major variations for tools presented to the user in the PartDesign WB.</p>
<p>For reference, they are depicted and categorized in figures 1 and 2,
with the newly redesigned icons made by <a class="reference external" href="https://github.com/agryson">Alexander Gryson</a> (kudos to his major rework of all of FreeCAD's icons!)</p>
<div class="figure align-center">
<img alt="command palette" src="../images/gsoc-2-1.png" style="width: 900px;"><p class="caption">Figure 1. Datum tools, additive/subtractive features and primitives.</p>
</div>
<div class="figure align-center">
<img alt="command palette" src="../images/gsoc-2-2.png" style="width: 600px;"><p class="caption">Figure 2. Transformations, dressup features, and multi-body boolean operation.</p>
</div>
<p>The Mirrored tool takes as input feature(s) and a mirror plane, but the other transformation tools like LinearPattern and PolarPattern behave in a fundamentally similar way.
By that reasoning, I figured that tests regarding the Mirrored tool really only have two major permutations if one assumes valid input:
the case where a choice of features and plane succeeds, and one where it doesn't.</p>
<div class="figure align-center">
<img alt="mirrored success" src="../images/gsoc-2-3.png" style="width: 600px;"><p class="caption">Figure 3. Success!</p>
</div>
<div class="figure align-center">
<img alt="mirrored failure" src="../images/gsoc-2-4.png" style="width: 600px;"><p class="caption">Figure 4. Failure...</p>
</div>
<p>So, I cleaned up the test case submission I started GSoC out with, <tt class="docutils literal">testMirroredSketchCase</tt>,
and added the new case depicted in figure 4, <tt class="docutils literal">testMirroredOffsetFailureCase</tt>.
However, I noticed both of my test cases involved <tt class="docutils literal">Sketch</tt>-based additive features, but no additive primitives.
So, I also included <tt class="docutils literal">testMirroredPrimitiveCase</tt> in <a class="reference external" href="https://github.com/FreeCAD/FreeCAD/pull/816">FreeCAD PR#816</a>.</p>
<p>What's nice is that besides <tt class="docutils literal">PartDesign Mirrored</tt> now being fixed, several other transformation tools' bugs were resolved.
Altogether, the PR resolved four issues, <a class="reference external" href="https://www.freecadweb.org/tracker/view.php?id=2235">2235</a>,
<a class="reference external" href="https://www.freecadweb.org/tracker/view.php?id=2248">2248</a>, <a class="reference external" href="https://www.freecadweb.org/tracker/view.php?id=3006">3006</a>,
and <a class="reference external" href="https://www.freecadweb.org/tracker/view.php?id=3065">3065</a>.</p>
<p>With all that wrapped up,
I moved on to adding tests for the various options for the fundamental sketch-based features <tt class="docutils literal">Pad</tt> and <tt class="docutils literal">Pocket</tt>.
Altogether, I added <tt class="docutils literal">testPadToFirstCase</tt>, <tt class="docutils literal">testPadtoLastCase</tt>, <tt class="docutils literal">testPadToFaceCase</tt>,
and <tt class="docutils literal">testPadTwoDimensionsCase</tt> to cover the options for <tt class="docutils literal">PartDesign Pad</tt>.
Unfortunately, these test cases are not very interesting to look at and mostly involve 2-4 lined up cubes similar to
what figure 3 looks like.</p>
<p>However, for <tt class="docutils literal">PartDesign Pad</tt>, things do get a little more interesting.
The base case is a simple reversed pad with a pocket in the middle, shown in figure 5.</p>
<div class="figure align-center">
<img alt="mirrored failure" src="../images/gsoc-2-5.png" style="width: 600px;"><p class="caption">Figure 5. The base Pocket test construction.</p>
</div>
<p>It was straightforward to add <tt class="docutils literal">testPocketDimensionCase</tt>, <tt class="docutils literal">testPocketThroughAllCase</tt>,
and <tt class="docutils literal">testPocketToFirstCase</tt>.
However, covering the last Pocket option with <tt class="docutils literal">testPocketToFaceCase</tt> is not (necessarily) so trivial.</p>
<p>If you refer to figure 5, you'll note that the base Pad feature is a hexahedron, or six-sided shape.
The Pocket feature adds four new faces to the overall shape, <tt class="docutils literal">Face7</tt> through <tt class="docutils literal">Face10</tt>.
However, references relying on the numbering of those faces is inherently brittle and it turns out that
a particular face number OpenCASCADE &gt; 7.0 does not correspond to the same face in a lower version, e.g.
the version used on the FreeCAD CI machines over at Travis.</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="gsoc-week-1-recap/" class="u-url">GSoC Week 1 Recap</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Kurt Kremitzki
            </span></p>
            <p class="dateline"><a href="gsoc-week-1-recap/" rel="bookmark"><time class="published dt-published" datetime="2017-06-06T14:28:12-05:00" title="2017-06-06 14:28">2017-06-06 14:28</time></a></p>
                <p class="commentline">            <a href="gsoc-week-1-recap/#disqus_thread" data-disqus-identifier="cache/posts/gsoc-week-1-recap.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>The first week of Google Summer of Code has ended, and so it's time for a recap post!</p>
<p>The main topic this week was <a class="reference external" href="https://www.freecadweb.org/wiki/PartDesign_Mirrored">PartDesign Mirrored</a>, a fairly self-explanatory feature,
with a show-stopping bug explained in <a class="reference external" href="https://freecadweb.org/tracker/view.php?id=3006">FreeCAD issue 3006</a>.</p>
<div class="figure align-center">
<img alt="unit cube construction" src="../images/gsoc-1-1.png" style="width: 600px;"><p class="caption">Figure 1. The base of my PartDesign Mirrored experiments.</p>
</div>
<p>In this picture, we have a simple <tt class="docutils literal">1 mm</tt> square sketch (pictured in white) attached to the <span class="math">\(xy\)</span>-plane.
One corner is at the origin, and the sketch is the base for a Pad feature <tt class="docutils literal">1 mm</tt> high.
Length is handled internally as <tt class="docutils literal">mm</tt> by FreeCAD, so this "unit cube" serves as a useful basis for testing behavior.
A useful alteration involves displacing this cube, say, <tt class="docutils literal">1 mm</tt> up the <span class="math">\(y\)</span>-axis.
This constructs a case where mirroring not all mirrorings should succeed, but we'll get into that later.</p>
<p>Let's turn now to the bug itself, depicted in figure 2.
The unit cube is supposed to be mirrored about its vertical sketch axis (the <span class="math">\(y\)</span>-axis, pictured running off to the top right.)
Obviously, it's not, and the failure is helpfully represented in red.</p>
<div class="figure align-center">
<img alt="mirroring bug" src="../images/gsoc-1-2.png" style="width: 600px;"><p class="caption">Figure 2. FreeCAD bug 3006 in action.</p>
</div>
<p>Note that the body diagonal of the mirrored part should run from the origin to  <span class="math">\((-1, 1, 1)\)</span>.
Instead, it's going to <span class="math">\((1, -1, -1)\)</span>, in the opposite direction.</p>
<p>Well, this was my first really serious bug to tackle for the summer.
I chose this as a way to really dive in, since it directly involves Open CASCADE, the open source C++ geometry kernel at the heart of FreeCAD.</p>
<p>However, my programming background is chiefly with Python (as well as JavaScript and Lua), all interpreted languages.
One nicety of that sort of language is that it can be very quick to debug and examine behavior using the interpreter.
There is a Python debugger, <tt class="docutils literal">pdb</tt>, but I rarely needed to use it for my mostly personal-sized projects.
Even then, it's quite straightforward to use since you're already in an interpreter-native environment.</p>
<p>C++ is a very different beast. In this case, stepping through the code with a debugger was my only choice.
I use Neovim as my IDE, though, so I wanted a way to combine the power of my text editor with my debugger.
So, I found and set up <a class="reference external" href="https://github.com/dbgx/lldb.nvim">LLDB.nvim</a>, an LLDB frontend, with an event-based, non-blocking UI,
session-saving, and
"... takes advantage of Neovim's job API to spawn a separate process and communicates with the Neovim process using RPC calls."</p>
<p>Pretty nice. Anyway, I was able to step through the code and see exactly what was flying around, just like I wanted.</p>
<div class="figure align-center">
<img alt="neovim" src="../images/neovim1.png" style="width: 600px;"><p class="caption">Figure 3. Neovim in an LLDB debug session.</p>
</div>
<p>So, what was the problem? Hah! Not so simple. Turns out there are <em>at least four bugs here!!</em></p>
<p>First, the algorithm which first checks if the mirrored shapes are adjacent and thus, can be fused, was broken.</p>
<p>Once this failed, FreeCAD then attempts to generate a mesh from the shape, and then converts a generalized transformation object representing the mirroring into a matrix to put the mesh in the correct place.
It turns out that in Open CASCADE 7.0.0, the <tt class="docutils literal">gp_Trsf</tt> API was changed so that <tt class="docutils literal"><span class="pre">gp_Trsf::VectorialPart()</span></tt> returns a 3x3 matrix including the scale factor.
The previous behavior was to return the homogeneous part of the transformation which does not include the scale factor, and the FreeCAD algorithm for constructing the 4x4 matrix for the mesh included multiplying every term by a scale factor.
In other words, the scale factor multiplication was happening twice. The scale factor I had observed in the debugger was -1, so this perfectly explained the inverted positioning of the failure result!</p>
<p>The third bug, of a much more minor nature, involved a a classic "failure... success!" message displayed in the event of a mirroring failure, and was easier to fix.</p>
<p>The fourth, though, was a bit trickier! It only appeared when fixing the mesh placement.</p>
<div class="figure align-center">
<img alt="new mirroring bug" src="../images/gsoc-1-3.png" style="width: 600px;"><p class="caption">Figure 4. A strange, new mirroring bug.</p>
</div>
<p>This one was diagnosed by ickby, my mentor for this project.
It turns out the failure meshes' faces were getting constructed inside out, and so the material's color was not considered "illuminated".</p>
<p>The three of us considered a few different options to get around this. One way would be to use Coin3D, FreeCAD's scene graph library, and change the material
properties to define something that looked the same, illuminated or not. Another is to essentially duplicate each face with the second instance having an inverted normal, so that you're guaranteed to have an outward-facing face.</p>
<p>The fix ended up being much simpler than that! It was possible to simply change the vertex ordering. Originally, it was set to <tt class="docutils literal">COUNTERCLOCKWISE</tt>.
However, in figure 4, you can see that simply changing it to <tt class="docutils literal">CLOCKWISE</tt> would not be an obvious fix.
Abdullah also fixed this one, presumably by checking the docs for that option and finding that there was an "option C", <tt class="docutils literal">UNKNOWN</tt>. That did the trick!</p>
<p>So now, PartDesign Mirrored is fixed and ready. Not a bad start for the summer!</p>
<!-- Open CASCADE and quaternions -->
<!-- Transformation matrices -->
<!-- OpenInventor and tessellation -->
<!-- Plans for the future -->
<!-- Rebuild test -->
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="my-freecad-project-was-accepted-into-google-summer-of-code/" class="u-url">My FreeCAD project was accepted into Google Summer of Code!</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Kurt Kremitzki
            </span></p>
            <p class="dateline"><a href="my-freecad-project-was-accepted-into-google-summer-of-code/" rel="bookmark"><time class="published dt-published" datetime="2017-05-06T02:41:23-05:00" title="2017-05-06 02:41">2017-05-06 02:41</time></a></p>
                <p class="commentline">            <a href="my-freecad-project-was-accepted-into-google-summer-of-code/#disqus_thread" data-disqus-identifier="cache/posts/my-freecad-project-was-accepted-into-google-summer-of-code.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>It's been almost a year since my last post, which just so happened to be about FreeCAD
as well. It's been a busy year: I've been studying machine design, robotics; partial differential
equations in general, and heat and mass transfer in particular. I've also been studying the source
code of FreeCAD while honing my sysadmin skills by helping maintain project infrastructure.
My hard work has paid off, and <a class="reference external" href="https://summerofcode.withgoogle.com/projects/#5752969237626880">my Google Summer of Code project proposal </a>
was accepted! I'm going to be working on improving the parametric part design workbench and writing
test code to make the module more robust for future development.</p>
<p>As a result, I've decided to publish my daily log here. I'll be posting weekly summaries once the
coding period begins on May 30, as well as more in-depth ad hoc blogging on interesting developments over the summer.
My goal is to both document my project and to produce a useful reference for other developers wanting to get started
contributing to FreeCAD.</p>
<p>The rest of May is part of the Community Bonding Period, and so I'll ramp up to full speed with an introductory series
of posts. Here are a few rough-draft titles to highlight my planned topics:</p>
<ul class="simple">
<li>
<a class="reference external" href="https://github.com/distcc/distcc">Neovim</a> as an IDE:<ol class="arabic">
<li>Building your base, or practically pluginless</li>
<li>What makes an IDE? An overview of features</li>
<li>Unix as an IDE, or knowing your tools</li>
<li>Neovim with Python 2 and 3</li>
<li>Neovim with C++</li>
<li>Asynchronous autobuilding with Neovim</li>
</ol>
</li>
<li>Distributed compilation with <a class="reference external" href="https://github.com/distcc/distcc">distcc</a>
</li>
<li>Speaking source code: how to fix your first FreeCAD bug</li>
<li>Contributing to open source communities (and FreeCAD in particular)</li>
</ul>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="getting-started-with-freecad-development-in-ubuntu-1604/" class="u-url">Getting Started with FreeCAD Development in Ubuntu 16.04</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Kurt Kremitzki
            </span></p>
            <p class="dateline"><a href="getting-started-with-freecad-development-in-ubuntu-1604/" rel="bookmark"><time class="published dt-published" datetime="2016-06-05T06:17:51-05:00" title="2016-06-05 06:17">2016-06-05 06:17</time></a></p>
                <p class="commentline">            <a href="getting-started-with-freecad-development-in-ubuntu-1604/#disqus_thread" data-disqus-identifier="cache/posts/getting-started-with-freecad-development-in-ubuntu-1604.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p><a class="reference external" href="http://www.freecadweb.org/">FreeCAD</a> is a multi-platform (Windows, Mac, Linux) open source parametric 3D CAD modeler, and can read
and write many open file formats.</p>
<p>An explanation of the many virtues of open source software can be found at <a class="reference external" href="http://opensourceforamerica.org/learn-more/benefits-of-open-source-software/">Open Source for America</a> and elsewhere. To quote OSFA,</p>
<blockquote>
The Open Source model harnesses the power of distributed peer review and transparency to create high-quality, secure
and easily integrated software at an accelerated pace and lower cost.</blockquote>
<p>Commerical-grade CAD software, while incredibly useful, has several downsides including being locked behind 4 or 5 digit licensing costs,
and its use in amateur projects or the developing world is often facilitated by piracy. FreeCAD, on the other hand, is free as in beer
and free as in freedom, although it is currently under development. However, one of the benefits of the open source model is the ease
with which interested people can contribute to the project and make better tools for all mankind.</p>
<p>While using FreeCAD, I noticed a few typos in the menus; although my first contribution to the project wasn't too significant, I
documented the process of getting a development environment set up on my Ubuntu 16.04 desktop so that others could follow the same
steps and begin contributing.</p>
<ol class="arabic simple">
<li>Pull down a copy of the code. (If you don't have a copy of git, run <tt class="docutils literal">sudo <span class="pre">apt-get</span> install git</tt>.)</li>
</ol>
<blockquote>
<pre class="code bash"><a name="rest_code_f67eb74822004b8285335453893d5b7e-1"></a>git clone https://github.com/FreeCAD/FreeCAD.git freecad-code
<a name="rest_code_f67eb74822004b8285335453893d5b7e-2"></a>mkdir freecad-build
</pre>
</blockquote>
<ol class="arabic simple" start="2">
<li>Install all dependencies.</li>
</ol>
<blockquote>
<pre class="code bash"><a name="rest_code_66cdd73aaa344d729e4cd6b53c712810-1"></a>sudo apt-get install build-essential cmake python python-matplotlib libtool libcoin80-dev <span class="se">\</span>
<a name="rest_code_66cdd73aaa344d729e4cd6b53c712810-2"></a>  libsoqt4-dev libxerces-c-dev libboost-dev libboost-filesystem-dev libboost-regex-dev  <span class="se">\</span>
<a name="rest_code_66cdd73aaa344d729e4cd6b53c712810-3"></a>  libboost-program-options-dev libboost-signals-dev libboost-thread-dev libboost-python-dev <span class="se">\</span>
<a name="rest_code_66cdd73aaa344d729e4cd6b53c712810-4"></a>  libqt4-dev libqt4-opengl-dev qt4-dev-tools python-dev python-pyside pyside-tools <span class="s1">'liboce*-dev'</span> <span class="se">\</span>
<a name="rest_code_66cdd73aaa344d729e4cd6b53c712810-5"></a>  oce-draw libeigen3-dev libqtwebkit-dev libshiboken-dev libpyside-dev libode-dev swig libzipios++-dev <span class="se">\</span>
<a name="rest_code_66cdd73aaa344d729e4cd6b53c712810-6"></a>  libfreetype6 libfreetype6-dev
<a name="rest_code_66cdd73aaa344d729e4cd6b53c712810-7"></a>
<a name="rest_code_66cdd73aaa344d729e4cd6b53c712810-8"></a><span class="c1"># Install optional packages</span>
<a name="rest_code_66cdd73aaa344d729e4cd6b53c712810-9"></a>sudo apt-get install libsimage-dev checkinstall python-pivy python-qt4 doxygen <span class="se">\</span>
<a name="rest_code_66cdd73aaa344d729e4cd6b53c712810-10"></a>  libcoin80-doc libspnav-dev
</pre>
</blockquote>
<ol class="arabic simple" start="3">
<li>Move into build folder, make and compile the software. Use the <tt class="docutils literal"><span class="pre">-j</span> $(nproc)</tt> flag to use all N of your CPU cores
when compiling; some recommend using N + 1 CPU cores, which can be done by instead running <tt class="docutils literal">make <span class="pre">-j$((</span> $(nproc) + 1 )) .</tt>.
Don't forget the period at the end of the <tt class="docutils literal">make</tt> command, which tells it to put the compiled software in the current
<tt class="docutils literal"><span class="pre">freecad-build</span></tt> directory; it's good to keep the source code and build directories separate.</li>
</ol>
<blockquote>
<pre class="code bash"><a name="rest_code_182722f6ab2140df96f4a1506a282d7f-1"></a><span class="nb">cd</span> freecad-build
<a name="rest_code_182722f6ab2140df96f4a1506a282d7f-2"></a>cmake ../freecad-code
<a name="rest_code_182722f6ab2140df96f4a1506a282d7f-3"></a>make -j<span class="k">$(</span>nproc<span class="k">)</span> .
</pre>
</blockquote>
<ol class="arabic simple" start="4">
<li>Fix Ubuntu 64-bit issue. If you are using a 64-bit version of Ubuntu (hopefully), you may run in to the following
error message, which occurs because the expected <tt class="docutils literal">libfreeimage.so</tt> file was moved into a subdirectory of <tt class="docutils literal">/usr/lib/</tt>.</li>
</ol>
<blockquote>
<pre class="code bash"><a name="rest_code_b6707817aec84b25a27f4456f0659de5-1"></a>make<span class="o">[</span><span class="m">2</span><span class="o">]</span>: *** No rule to make target <span class="s1">'/usr/lib/libfreeimage.so'</span>, needed by <span class="s1">'lib/libSMDS.so'</span>.  Stop.
<a name="rest_code_b6707817aec84b25a27f4456f0659de5-2"></a>
<a name="rest_code_b6707817aec84b25a27f4456f0659de5-3"></a><span class="c1"># Fix with this line.</span>
<a name="rest_code_b6707817aec84b25a27f4456f0659de5-4"></a>sudo ln -s /usr/lib/x86_64-linux-gnu/libfreeimage.so /usr/lib
</pre>
</blockquote>
<p>Once the build is complete, a runnable copy of the FreeCAD executable will be in the <tt class="docutils literal"><span class="pre">freecad-build</span></tt> folder. Any changes
made to the source code can be tested after re-compiling the executable.</p>
<p>Hopefully this post helps someone out there! Even if you are only contributing to the documentation as you learn FreeCAD,
your contribution is valuable and can help tons of people across the globe.</p>
</div>
    </div>
    </article>
</div>
        <nav class="postindexpager"><ul class="pager">
<li class="next">
                <a href="index-1.html" rel="next">Older posts</a>
            </li>
        </ul></nav><script>var disqus_shortname="kkremitzki";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha256-ExtbCSBuYA7kq1Pz362ibde9nnsHYPt6JxuxYeZbU+c=" crossorigin="anonymous"></script><script>
                renderMathInElement(document.body);
            </script>
</div>
        <!--End of body content-->

        <footer id="footer">
            
Contents © 2017         <a href="mailto:kkremitzki@gmail.com">Kurt Kremitzki</a>
- Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         

            
        </footer>
</div>
</div>

            <script src="../assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-77885418-1', 'auto');
ga('send', 'pageview');
</script>
</body>
</html>
